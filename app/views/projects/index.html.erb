<style>
    table, td {border: 1px solid black;}
</style>

<h1>Projects</h1>

<div>
  <% if user_signed_in? %>
    <% if current_user.user_role == "Coordinator" || current_user.user_role == "Manager" %>

      <div>
        <%= form_tag "/projects", method: :get do %>
          <span>Search Keyword: </span>
          <%= text_field_tag :search_keyword, params[:search_keyword] %>
          <%= check_box_tag :pending_projects %><%= label_tag(:pending_projects, "Pending Projects") %>
          <%= check_box_tag :confirmed_projects %><%= label_tag(:confirmed_projects, "Confirmed Projects") %>
          <%= submit_tag "Search" %>
          <%= link_to '<button type="button">Reset</button>'.html_safe, projects_path %>
        <% end %>
        <br>
      </div>

      <table>
        <tr>
          <th>Project ID</th>
          <th>Project Title</th>
          <th>Lecturer</th>
          <th>Specialisation</th>
          <% if current_user.user_role == "Coordinator" %><th>Approval Status</th><% end %>
          <th>Project Details</th>
        </tr>

        <% @projects.each do |project| %>
          <% # Find out the name of lecturer/supervisor. Temporary variable. %>
          <% lecturer = @users.find(project.supervisor_id) %>

          <tr>
            <td><%= project.project_id %></td>
            <td><%= project.project_title %></td>

            <% # Check if local variable `lecturer` is empty. %>
            <% unless lecturer.nil? || lecturer == ""  %>
              <td><%= lecturer.user_name %></td>
            <% else %>
              <td><%= project.supervisor_id %></td>
            <% end %>

            <td><%= project.project_specialisation %></td>
            <% if current_user.user_role == "Coordinator" %><td><%= project.project_approval_status %></td><% end %>
            <td>
              <%= link_to "View", project %>
              <% if current_user.user_role == "Coordinator" %>
                <span> | <a href="/projects/<%= project.project_id %>/edit">Edit</a></span>
              <% end %>
            </td>
          </tr>
        <% end %>

      </table>

      <% if current_user.user_role == "Coordinator" %>
        <%= link_to "New", new_project_path() %>
      <% end %>

    <% else %>
      <p><%= errmsg_no_permission_to_access %></p>
    <% end %>
  <% else %>
    <p><%= errmsg_no_permission_to_access %></p>
  <% end %>
</div>